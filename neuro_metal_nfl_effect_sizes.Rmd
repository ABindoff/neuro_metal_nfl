---
title: "neuro_metal_nfl_effect_sizes"
author: "Bindoff, A."
date: "9 June 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r load, message = F, warning = F}
library(readr)
library(dplyr)
library(ggplot2)
library(reshape2)
library(GGally)
library(sjPlot)
library(plotmo)
library(lme4)

df <- read_csv("neuro_metal_nfl.csv", trim_ws = T)
names(df) <- gsub("\\b\\d+\\b", "", names(df)) # remove numbers
names(df) <- gsub("  ", "", names(df)) # remove extraneous blanks
names(df)[1:6] <- c("id", "age", "strain", "region", "sample", "dilution")

df$id <- as.factor(df$id)
df$age <- as.factor(df$age)
df$strain <- gsub("[[:punct:]]", "", df$strain)
df$strain <- gsub("^WT AP.*", "WT_APPPS1", as.character(df$strain))
df$strain <- as.factor(df$strain)
df$region <- as.factor(df$region)

df <- select(df, c(1,2,3,4,5,9,10,11,13,14,17,18,21,22,23,24)) %>%# remove metals at or below detection limit
    filter(strain == "WT" | strain == "NFL", age == 5 | age == 22)
df <- na.omit(df)

```

 

```{r transformation, message = F, warning = F, eval = T}


df$logAl <- log(df$Al)
df$logFe <- log(df$Fe)
df$logCa <- log(df$Ca)
df$logZn <- log(df$Zn)
df[,6:20] <- scale(df[,6:20])

```


Some measures are log-transformed as per previous analysis, then all measures standardised to have $\mu = 0$ and $\sigma^2 = 1$


We are primarily interested in metals inside cells, and K is ubiquitous in cells, so it may provide a proxy for cell density in tissue samples. The correlation matrix plots show a strong correlation between K and Fe, K and Zn, and a very strong correlation between K and Rb. Conditioning on region, some of these correlations disappear (not shown explicitly). We know that K and Rb are exchangeable, and that the biological function of Rb is unknown (see introduction to Roberts et al. 2016 "Rubidium and potassium levels are altered in Alzheimerâ€™s disease brain and blood but not in cerebrospinal fluid" for an overview).  This suggests that higher levels of Fe or Zn may be explained by a higher cell density in the tissue samples, particularly looking at different brain regions where we might expect differing cell densities.  



```{r correlationmatrixK, message = F, warning = F}
# fit2 <- manova(cbind(logAl, logFe, K, Rb, logZn) ~ 
df0 <- df[, c("region", "logAl", "logFe", "K", "Rb", "logZn")]
ggpairs(df0, aes(colour = region, alpha = 0.05), legend = c(1,1))



```

  
There are differences in K and Rb between NFL and wt mice, so we explore these differences more closely (looking at regions independently).  **lengthy output from t-tests has been suppressed**


```{r by_region}
ggplot(df, aes(x = K, y = logFe, colour = strain, alpha = 0.05)) + 
  geom_point() +
  geom_smooth(method = lm)

j_region <- c("Brain stem", "Cerebellum", "Cortex", "Hippocampus", "Olfactory bulb", "Siatic nerve")

Kj <- lapply(j_region, function(j) t.test(K ~ strain, data = filter(df, region == j)))
Rbj <- lapply(j_region, function(j) t.test(Rb ~ strain, data = filter(df, region == j)))
```


After a Bonferroni correction ($\alpha = .0083$), *no significant difference in K* between strains in different regions was observed, but *differences for Rb were observed for the Olfactory bulb*.

### age:strain interactions for Cortex region only

```{r linear_model_cortex}
df0 <- df
df <- filter(df, region == "Cortex")

summary(fit <- lm(logAl ~ strain*age, df))
plotmo(fit, method = "partdep")

summary(fit <- lm(logFe ~ strain*age, df))
plotmo(fit, method = "partdep")

summary(fit <- lm(K ~ strain*age, df))
plotmo(fit, method = "partdep")

summary(fit <- lm(Rb ~ strain*age, df))
plotmo(fit, method = "partdep")

summary(fit <- lm(logZn ~ strain*age, df))
plotmo(fit, method = "partdep")

```

#### including K as a covariate

In some sense this accounts for some of the small (but non-significant) differences in cell densities between strains. 

```{r K as covariate}
ggplot(df, aes(x = K, y = logFe, colour = strain, alpha = 0.05)) + 
  geom_point() +
  geom_smooth(method = lm)

summary(fit <- lm(logFe ~ K + strain*age, df))
plotmo(fit, method = "partdep")

```


### Region:strain, region:age, strain:age regression analysis 

```{r linear_model_region_interactions}
df <- df0
summary(fit <- lm(logAl ~ region + strain + age +
                 region:strain +
                 region:age +
                 strain:age, df))
plotmo(fit, method = "partdep")

summary(fit <- lm(logFe ~ region + strain + age +
                 region:strain +
                 region:age +
                 strain:age, df))
plotmo(fit, method = "partdep")

summary(fit <- lm(K ~ region + strain + age +
                 region:strain +
                 region:age +
                 strain:age, df))
plotmo(fit, method = "partdep")

summary(fit <- lm(Rb ~ region + strain + age +
                 region:strain +
                 region:age +
                 strain:age, df))
plotmo(fit, method = "partdep")

summary(fit <- lm(logZn ~ region + strain + age +
                 region:strain +
                 region:age +
                 strain:age, df))
plotmo(fit, method = "partdep")

```


  

